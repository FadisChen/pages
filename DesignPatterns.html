<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Design Patterns å­¸ç¿’æŒ‡å—</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap"
        rel="stylesheet">

    <!-- Markmap -->
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/markmap-view"></script>
    <script src="https://cdn.jsdelivr.net/npm/markmap-lib"></script>

    <!-- Mermaid -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

    <!-- Highlight.js -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/csharp.min.js"></script>

    <style>
        body {
            font-family: 'Outfit', 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            height: 100vh;
            overflow: hidden;
            color: #1e293b;
        }

        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        #markmap-container svg {
            width: 100%;
            height: 100%;
        }

        .markdown-body h1,
        .markdown-body h2,
        .markdown-body h3 {
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            font-weight: 700;
            line-height: 1.25;
        }

        .markdown-body h2 {
            font-size: 1.5em;
            border-bottom: 1px solid #eaecef;
            padding-bottom: 0.3em;
        }

        .markdown-body h3 {
            font-size: 1.25em;
        }

        .markdown-body p {
            margin-bottom: 1em;
            line-height: 1.6;
        }

        .markdown-body ul {
            list-style-type: disc;
            padding-left: 2em;
            margin-bottom: 1em;
        }

        .markdown-body code {
            background-color: rgba(175, 184, 193, 0.2);
            padding: 0.2em 0.4em;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.85em;
        }

        .markdown-body pre code {
            background-color: transparent;
            padding: 0;
        }

        .nav-item.active {
            background-color: #e0e7ff;
            /* indigo-100 */
            color: #4338ca;
            /* indigo-700 */
            border-left: 4px solid #4f46e5;
            /* indigo-600 */
        }

        /* Mermaid Fixes */
        .mermaid {
            background: transparent;
            display: flex;
            justify-content: center;
        }
    </style>
</head>

<body class="flex h-screen">

    <!-- Sidebar: Pattern List / Markmap Focus -->
    <aside class="w-80 glass flex flex-col z-20 transition-all duration-300 transform" id="sidebar">
        <div class="p-6 border-b border-white/50">
            <button onclick="app.toggleMapOnly()" class="float-right text-slate-400 hover:text-indigo-600 lg:hidden">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                        clip-rule="evenodd" />
                </svg>
            </button>
            <h1 class="text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                Design Patterns
            </h1>
            <p class="text-xs text-slate-500 mt-1">äº’å‹•å¼å­¸ç¿’æŒ‡å— (C# Edition)</p>
        </div>

        <nav class="flex-1 overflow-y-auto py-4" id="pattern-nav">
            <!-- Dynamically populated -->
        </nav>

        <div class="p-4 border-t border-white/50 text-center text-xs text-slate-400">
            Design Patterns Visualizer v1.2
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-full relative overflow-hidden">

        <!-- Toggle View Controls -->
        <div class="absolute top-4 right-4 z-50 flex gap-2">
            <button onclick="app.toggleMapOnly()"
                class="glass px-3 py-1.5 rounded-lg text-sm font-medium hover:bg-white/80 transition-colors shadow-sm flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path
                        d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                </svg>
                <span>å…¨åœ°åœ–æ¨¡å¼</span>
            </button>
        </div>

        <!-- Split View Container -->
        <div class="flex-1 flex w-full h-full">

            <!-- Left/Top: Markmap -->
            <div id="map-panel" class="w-1/2 h-full border-r border-white/50 transition-all duration-300 relative">
                <div
                    class="absolute top-4 left-4 z-10 glass px-2 py-1 rounded text-xs font-bold text-slate-500 uppercase tracking-wider">
                    Knowledge Map
                </div>
                <svg id="markmap" class="w-full h-full"></svg>
            </div>

            <!-- Right/Bottom: Details -->
            <div id="detail-panel"
                class="w-1/2 h-full overflow-y-auto bg-white/40 backdrop-blur-md p-8 transition-all duration-300">
                <div id="empty-state" class="h-full flex flex-col items-center justify-center text-slate-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mb-4 opacity-50" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                            d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                    </svg>
                    <p class="text-lg font-medium">é»æ“Šå·¦å´åœ°åœ–ç¯€é»ä»¥æŸ¥çœ‹è©³æƒ…</p>
                    <p class="text-sm mt-2">åŒ…å«åœ–è§£ã€èªªæ˜èˆ‡ç¨‹å¼ç¢¼ç¯„ä¾‹</p>
                </div>

                <div id="content-state" class="hidden max-w-3xl mx-auto pb-20">
                    <!-- Dynamic Content -->
                    <div class="mb-2">
                        <span id="pattern-type"
                            class="px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-xs font-bold uppercase tracking-wider">Type</span>
                    </div>
                    <h2 id="pattern-title" class="text-3xl font-bold text-slate-800 mb-6">Pattern Name</h2>

                    <!-- Diagram -->
                    <div
                        class="glass-panel p-6 rounded-2xl mb-8 flex flex-col items-center bg-white/60 overflow-hidden relative group">
                        <div id="mermaid-diagram" class="mermaid">
                            <!-- Mermaid render here -->
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="space-y-6">
                        <section>
                            <h3 class="text-lg font-bold text-slate-700 flex items-center gap-2 mb-3">
                                <span class="bg-blue-100 text-blue-600 p-1 rounded">ğŸ“</span> æ¨¡å¼å®šç¾©
                            </h3>
                            <p id="pattern-desc"
                                class="text-slate-600 leading-relaxed text-base bg-white/40 p-4 rounded-xl border border-white/50">
                                Description here.
                            </p>
                        </section>

                        <section>
                            <h3 class="text-lg font-bold text-slate-700 flex items-center gap-2 mb-3">
                                <span class="bg-green-100 text-green-600 p-1 rounded">ğŸ¯</span> ä½¿ç”¨æƒ…å¢ƒ (When to use)
                            </h3>
                            <ul id="pattern-scenario"
                                class="list-disc list-inside space-y-2 text-slate-600 bg-white/40 p-4 rounded-xl border border-white/50">
                                <li>Scenario 1</li>
                            </ul>
                        </section>

                        <section>
                            <h3 class="text-lg font-bold text-slate-700 flex items-center gap-2 mb-3">
                                <span class="bg-purple-100 text-purple-600 p-1 rounded">ğŸ’»</span> C# å¯¦ä½œç¯„ä¾‹
                            </h3>
                            <div class="bg-slate-50 rounded-xl border border-slate-200 p-4 mb-4">
                                <div class="mb-3">
                                    <h4 class="text-sm font-bold text-slate-700 mb-1">ç¨‹å¼ç¢¼èªªæ˜ï¼š</h4>
                                    <p id="code-desc" class="text-sm text-slate-600">èªªæ˜æ–‡å­—...</p>
                                </div>
                                <div>
                                    <h4 class="text-sm font-bold text-slate-700 mb-1">å¥—ç”¨å„ªé»ï¼š</h4>
                                    <ul id="code-pros" class="text-sm text-slate-600 list-disc list-inside">
                                        <li>å„ªé»1</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="rounded-xl overflow-hidden shadow-lg border border-slate-200 relative">
                                <pre><code id="pattern-code" class="language-csharp">
// Code here
                                </code></pre>
                            </div>
                        </section>
                    </div>

                </div>
            </div>
        </div>
    </main>

    <script>
        // --- DATA ---
        const DESIGN_PATTERNS = {
            creational: {
                name: "å‰µå»ºå‹ (Creational)",
                description: "é—œæ³¨ç‰©ä»¶çš„å»ºç«‹éç¨‹ï¼Œå°‡ç‰©ä»¶çš„å»ºç«‹èˆ‡ä½¿ç”¨åˆ†é›¢ã€‚",
                items: [
                    {
                        id: "singleton",
                        name: "Singleton (å–®ä¾‹æ¨¡å¼)",
                        desc: "ä¿è­‰ä¸€å€‹é¡åˆ¥åªæœ‰ä¸€å€‹å¯¦ä¾‹ (Instance)ï¼Œä¸¦æä¾›ä¸€å€‹å­˜å–å®ƒçš„å…¨åŸŸè¨ªå•é»ã€‚",
                        scenarios: [
                            "è¨­å®šæª”ç®¡ç† (Configuration Manager)",
                            "è³‡æ–™åº«é€£ç·šæ±  (Connection Pool)",
                            "æ—¥èªŒè¨˜éŒ„å™¨ (Logger)",
                            "å¿«å–æ©Ÿåˆ¶ (Cache)"
                        ],
                        diagram: `classDiagram
    class Singleton {
        - static instance: Singleton
        - Singleton()
        + static getInstance() : Singleton
    }`,
                        code: `public sealed class Singleton
{
    private static Singleton _instance = null;
    private static readonly object _padlock = new object();

    private Singleton() { }

    public static Singleton Instance
    {
        get
        {
            // Thread Safe Lock
            lock (_padlock)
            {
                if (_instance == null)
                {
                    _instance = new Singleton();
                }
                return _instance;
            }
        }
    }
}`,
                        codeDesc: "ä½¿ç”¨ sealed é—œéµå­—é˜²æ­¢ç¹¼æ‰¿ï¼Œä¸¦å°‡å»ºæ§‹å­è¨­ç‚º private ç¦æ­¢å¤–éƒ¨å¯¦ä¾‹åŒ–ã€‚é€é lock æ©Ÿåˆ¶ç¢ºä¿åœ¨å¤šåŸ·è¡Œç·’ç’°å¢ƒä¸‹ï¼Œåªæœƒå»ºç«‹ä¸€å€‹å¯¦ä¾‹ã€‚",
                        pros: [
                            "ç¢ºä¿å…¨åŸŸå”¯ä¸€å¯¦ä¾‹ï¼Œæ–¹ä¾¿ç®¡ç†å…±äº«è³‡æºã€‚",
                            "é¿å…é »ç¹å»ºç«‹éŠ·æ¯€ç‰©ä»¶ï¼Œç¯€çœç³»çµ±è³‡æºã€‚",
                            "æä¾›å°å”¯ä¸€å¯¦ä¾‹çš„å—æ§å­˜å–ã€‚"
                        ]
                    },
                    {
                        id: "factory_method",
                        name: "Factory Method (å·¥å» æ–¹æ³•)",
                        desc: "å®šç¾©ä¸€å€‹ç”¨æ–¼å»ºç«‹ç‰©ä»¶çš„ä»‹é¢ï¼Œä½†è®“å­é¡åˆ¥æ±ºå®šå¯¦ä¾‹åŒ–å“ªä¸€å€‹é¡åˆ¥ã€‚",
                        scenarios: [
                            "æ¡†æ¶éœ€è¦å»ºç«‹ç‰©ä»¶ä½†ç„¡æ³•é çŸ¥å…·é«”é¡åˆ¥",
                            "éœ€è¦æ“´å……æ–°çš„ç”¢å“é¡å‹æ™‚ä¸æƒ³ä¿®æ”¹æ—¢æœ‰ç¨‹å¼ç¢¼",
                            "è·¨å¹³å° GUI å…ƒä»¶ç”¢ç”Ÿ"
                        ],
                        diagram: `classDiagram
    class Creator {
        +factoryMethod() Product
        +someOperation()
    }
    class ConcreteCreatorA {
        +factoryMethod() Product
    }
    class ConcreteCreatorB {
        +factoryMethod() Product
    }
    class Product {
        <<interface>>
    }
    class ConcreteProductA
    class ConcreteProductB
    Creator <|-- ConcreteCreatorA
    Creator <|-- ConcreteCreatorB
    Product <|.. ConcreteProductA
    Product <|.. ConcreteProductB
    ConcreteCreatorA ..> ConcreteProductA
    ConcreteCreatorB ..> ConcreteProductB`,
                        code: `public abstract class Logistics
{
    // Factory Method
    public abstract ITransport CreateTransport();

    public string PlanDelivery()
    {
        var transport = CreateTransport();
        return $"Logistics: {transport.Deliver()}";
    }
}

public class RoadLogistics : Logistics
{
    public override ITransport CreateTransport() => new Truck();
}

public class SeaLogistics : Logistics
{
    public override ITransport CreateTransport() => new Ship();
}

public interface ITransport
{
    string Deliver();
}

public class Truck : ITransport
{
    public string Deliver() => "Truck delivery on road";
}

public class Ship : ITransport
{
    public string Deliver() => "Ship delivery by sea";
}`,
                        codeDesc: "Logistics æŠ½è±¡é¡åˆ¥å®šç¾©äº† `CreateTransport` ä»‹é¢ï¼Œä½†ä¸æ±ºå®šå…·é«”äº¤é€šå·¥å…·ã€‚ç”± `RoadLogistics` å’Œ `SeaLogistics` å¯¦ä½œè©²æ–¹æ³•ï¼Œæ±ºå®šç”¢ç”Ÿ `Truck` æˆ– `Ship`ã€‚",
                        pros: [
                            "ç¬¦åˆé–‹æ”¾å°é–‰åŸå‰‡ (OCP)ï¼Œæ–°å¢ç”¢å“ç¨®é¡ç„¡éœ€ä¿®æ”¹ Creator é‚è¼¯ã€‚",
                            "å–®ä¸€è·è²¬åŸå‰‡ (SRP)ï¼Œå°‡ç”¢å“å»ºç«‹ç¨‹å¼ç¢¼ç§»è‡³åŒä¸€ä½ç½®ã€‚",
                            "è§£è€¦äº†ç”¢å“çš„ä½¿ç”¨è€…èˆ‡ç”¢å“çš„å»ºç«‹éç¨‹ã€‚"
                        ]
                    },
                    {
                        id: "abstract_factory",
                        name: "Abstract Factory (æŠ½è±¡å·¥å» )",
                        desc: "æä¾›ä¸€å€‹ä»‹é¢ï¼Œç”¨æ–¼å»ºç«‹ç›¸é—œæˆ–ç›¸ä¾ç‰©ä»¶çš„ã€Œå®¶æ—ã€ï¼Œè€Œç„¡éœ€æŒ‡å®šå®ƒå€‘å…·é«”çš„é¡åˆ†ã€‚",
                        scenarios: [
                            "UI ä¸»é¡Œåˆ‡æ› (å»ºç«‹ä¸€ç³»åˆ— LightTheme æŒ‰éˆ•ã€è¦–çª—ã€é¸å–®)",
                            "è·¨å¹³å°è»Ÿé«”æ”¯æ´"
                        ],
                        diagram: `classDiagram
    class GUIFactory {
        <<interface>>
        +createButton()
        +createCheckbox()
    }
    class WinFactory {
        +createButton()
        +createCheckbox()
    }
    class MacFactory {
        +createButton()
        +createCheckbox()
    }
    GUIFactory <|.. WinFactory
    GUIFactory <|.. MacFactory`,
                        code: `public interface IGUIFactory
{
    IButton CreateButton();
    ICheckbox CreateCheckbox();
}

public class WinFactory : IGUIFactory
{
    public IButton CreateButton() => new WinButton();
    public ICheckbox CreateCheckbox() => new WinCheckbox();
}

public class MacFactory : IGUIFactory
{
    public IButton CreateButton() => new MacButton();
    public ICheckbox CreateCheckbox() => new MacCheckbox();
}

public class Application
{
    private IButton _button;
    public Application(IGUIFactory factory)
    {
        _button = factory.CreateButton();
    }
    public void Paint() => _button.Paint();
}`,
                        codeDesc: "å®šç¾©ä¸€å€‹å·¥å» ä»‹é¢ `IGUIFactory` ä¾†å»ºç«‹ä¸€ç³»åˆ—ç›¸é—œç‰©ä»¶ (Button, Checkbox)ã€‚é€éåˆ‡æ›å‚³å…¥ `Application` çš„å…·é«”å·¥å»  (WinFactory æˆ– MacFactory)ï¼Œå³å¯æ”¹è®Šæ•´é«”çš„ UI é¢¨æ ¼ã€‚",
                        pros: [
                            "å¯ä»¥ç¢ºä¿åŒä¸€å·¥å» æ‰€ç”¢ç”Ÿçš„ç”¢å“æ˜¯å½¼æ­¤ç›¸å®¹çš„ (Product Families)ã€‚",
                            "é¿å…èˆ‡å…·é«”ç”¢å“é¡åˆ¥ç·Šå¯†è€¦åˆã€‚",
                            "ç¬¦åˆå–®ä¸€è·è²¬åŸå‰‡èˆ‡é–‹æ”¾å°é–‰åŸå‰‡ã€‚"
                        ]
                    },
                    {
                        id: "builder",
                        name: "Builder (å»ºé€ è€…æ¨¡å¼)",
                        desc: "å°‡ä¸€å€‹è¤‡é›œç‰©ä»¶çš„å»ºæ§‹èˆ‡å…¶è¡¨ç¤ºåˆ†é›¢ï¼Œä½¿å¾—åŒæ¨£çš„å»ºæ§‹éç¨‹å¯ä»¥å»ºç«‹ä¸åŒçš„è¡¨ç¤ºã€‚",
                        scenarios: [
                            "SQL æŸ¥è©¢ç”¢ç”Ÿå™¨",
                            "è¤‡é›œçš„ç‰©ä»¶è¨­å®š (å¦‚ HttpClient)",
                            "é¤é»å®¢è£½åŒ–"
                        ],
                        diagram: `classDiagram
    class Director {
        +construct(builder)
    }
    class Builder {
        <<interface>>
        +buildPartA()
        +buildPartB()
        +getResult()
    }
    class ConcreteBuilder {
        -product
        +buildPartA()
        +buildPartB()
        +getResult()
    }
    Director o-- Builder
    Builder <|.. ConcreteBuilder`,
                        code: `public class BurgerBuilder
{
    private Burger _burger = new Burger();

    public BurgerBuilder AddCheese()
    {
        _burger.HasCheese = true;
        return this;
    }
    public BurgerBuilder AddLettuce()
    {
        _burger.HasLettuce = true;
        return this;
    }
    public Burger Build() => _burger;
}

// Usage
var burger = new BurgerBuilder()
    .AddCheese()
    .AddLettuce()
    .Build();`,
                        codeDesc: "ä½¿ç”¨ Fluent Interface é¢¨æ ¼ (Return this)ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥åƒé»é¤ä¸€æ¨£ä¸€æ­¥æ­¥çµ„è£ `Burger` ç‰©ä»¶ï¼Œæœ€å¾Œå‘¼å« `Build()` å–å¾—æˆå“ã€‚",
                        pros: [
                            "å¯ä»¥åˆ†æ­¥é©Ÿå»ºç«‹ç‰©ä»¶ï¼Œæˆ–å»¶é²åŸ·è¡Œæ­¥é©Ÿã€‚",
                            "åŒæ¨£çš„å»ºæ§‹æµç¨‹å¯ä»¥ç”¢ç”Ÿä¸åŒçš„ç”¢å“è¡¨ç¤ºã€‚",
                            "ä»£ç¢¼é–±è®€æ€§é«˜ï¼Œé¿å…äº†å»ºæ§‹å­åƒæ•¸éå¤š (Telescoping Constructor) çš„å•é¡Œã€‚"
                        ]
                    },
                    {
                        id: "prototype",
                        name: "Prototype (åŸå‹æ¨¡å¼)",
                        desc: "é€éè¤‡è£½ç¾æœ‰çš„å¯¦ä¾‹ä¾†å»ºç«‹æ–°çš„ç‰©ä»¶ï¼Œè€Œä¸æ˜¯é€éæ–°å»ºæ§‹å­ã€‚",
                        scenarios: [
                            "ç‰©ä»¶å»ºç«‹æˆæœ¬éé«˜",
                            "ç‰©ä»¶ä¹‹é–“åªæœ‰å°‘è¨±ç‹€æ…‹å·®ç•°"
                        ],
                        diagram: `classDiagram
    class Prototype {
        <<interface>>
        +clone()
    }
    class ConcretePrototype {
        +clone()
    }
    Prototype <|.. ConcretePrototype`,
                        code: `public class Person : ICloneable
{
    public string Name { get; set; }
    public int Age { get; set; }

    public object Clone()
    {
        // æ·ºå±¤è¤‡è£½ (Shallow Copy)
        return this.MemberwiseClone();
    }
}

// Usage
var p1 = new Person { Name = "Alice", Age = 30 };
var p2 = (Person)p1.Clone();
p2.Name = "Bob";`,
                        codeDesc: "å¯¦ä½œ `ICloneable` ä»‹é¢ï¼Œä½¿ç”¨ C# å…§å»ºçš„ `MemberwiseClone()` é€²è¡Œæ·ºå±¤è¤‡è£½ã€‚å¦‚æœéœ€è¦æ·±å±¤è¤‡è£½ (Deep Copy)ï¼Œå‰‡éœ€æ‰‹å‹•è™•ç†åƒè€ƒå‹åˆ¥çš„æ¬„ä½ã€‚",
                        pros: [
                            "å¯ä»¥ç›´æ¥è¤‡è£½è¤‡é›œç‰©ä»¶ï¼Œä¸éœ€è¦çŸ¥é“å…¶å…·é«”é¡åˆ¥ã€‚",
                            "æ¸›å°‘é‡è¤‡çš„åˆå§‹åŒ–ç¨‹å¼ç¢¼ã€‚",
                            "å¦‚æœæ˜¯è³‡æºå¯†é›†å‹çš„ç‰©ä»¶å»ºç«‹ï¼Œè¤‡è£½é€šå¸¸æ¯”æ–°å»ºæ›´æœ‰æ•ˆç‡ã€‚"
                        ]
                    }
                ]
            },
            structural: {
                name: "çµæ§‹å‹ (Structural)",
                description: "å¦‚ä½•çµ„åˆé¡åˆ¥å’Œç‰©ä»¶ä»¥ç²å¾—æ›´å¤§çš„çµæ§‹ã€‚",
                items: [
                    {
                        id: "adapter",
                        name: "Adapter (è½‰æ¥å™¨æ¨¡å¼)",
                        desc: "å°‡ä¸€å€‹é¡åˆ¥çš„ä»‹é¢è½‰æ›æˆå®¢æˆ¶å¸Œæœ›çš„å¦ä¸€å€‹ä»‹é¢ï¼Œè§£æ±ºä»‹é¢ä¸ç›¸å®¹å•é¡Œã€‚",
                        scenarios: [
                            "æ•´åˆèˆŠæœ‰ç³»çµ±",
                            "ä½¿ç”¨ç¬¬ä¸‰æ–¹å¥—ä»¶ä½†æ¥å£ä¸ç¬¦"
                        ],
                        diagram: `classDiagram
    class Target {
        +request()
    }
    class Adapter {
        -adaptee
        +request()
    }
    class Adaptee {
        +specificRequest()
    }
    Target <|.. Adapter
    Adapter --> Adaptee`,
                        code: `public interface ITarget
{
    string GetRequest();
}

public class Adaptee
{
    public string GetSpecificRequest() => "Specific ID";
}

public class Adapter : ITarget
{
    private readonly Adaptee _adaptee;
    public Adapter(Adaptee adaptee)
    {
        _adaptee = adaptee;
    }

    public string GetRequest()
    {
        return $"This is '{_adaptee.GetSpecificRequest()}'";
    }
}`,
                        codeDesc: "`Adapter` é¡åˆ¥åŒ…è£äº† `Adaptee` ç‰©ä»¶ã€‚ç•¶å®¢æˆ¶ç«¯å‘¼å« `GetRequest()` (ç›®æ¨™ä»‹é¢) æ™‚ï¼ŒAdapter å…§éƒ¨å°‡å…¶è½‰æ›å‘¼å« `Adaptee` çš„ `GetSpecificRequest()` (æ—¢æœ‰ä»‹é¢)ã€‚",
                        pros: [
                            "å–®ä¸€è·è²¬åŸå‰‡ï¼šå°‡ä»‹é¢è½‰æ›ç¨‹å¼ç¢¼å¾ä¸»è¦æ¥­å‹™é‚è¼¯ä¸­åˆ†é›¢ã€‚",
                            "é–‹æ”¾å°é–‰åŸå‰‡ï¼šå¯ä»¥åœ¨ä¸ä¿®æ”¹ç¾æœ‰å®¢æˆ¶ç«¯ç¨‹å¼ç¢¼çš„æƒ…æ³ä¸‹å¼•å…¥æ–°çš„è½‰æ¥å™¨ã€‚",
                            "è®“åŸæœ¬ä¸ç›¸å®¹çš„é¡åˆ¥å¯ä»¥å”åŒå·¥ä½œã€‚"
                        ]
                    },
                    {
                        id: "decorator",
                        name: "Decorator (è£é£¾è€…æ¨¡å¼)",
                        desc: "å‹•æ…‹åœ°çµ¦ä¸€å€‹ç‰©ä»¶æ·»åŠ ä¸€äº›é¡å¤–çš„è·è²¬ã€‚æ¯”ç¹¼æ‰¿æ›´éˆæ´»ã€‚",
                        scenarios: [
                            "I/O Stream (BufferedStream, GZipStream)",
                            "ç‚º UI å…ƒä»¶æ·»åŠ é‚Šæ¡†ã€æ»¾å‹•æ¢"
                        ],
                        diagram: `classDiagram
    class Component {
        +operation()
    }
    class ConcreteComponent {
        +operation()
    }
    class Decorator {
        -component
        +operation()
    }
    class ConcreteDecoratorA {
        +operation()
    }
    Component <|.. ConcreteComponent
    Component <|.. Decorator
    Decorator <|-- ConcreteDecoratorA`,
                        code: `public abstract class Coffee
{
    public abstract double Cost();
    public abstract string Description();
}

public class SimpleCoffee : Coffee
{
    public override double Cost() => 10.0;
    public override string Description() => "Simple Coffee";
}

public class MilkDecorator : Coffee
{
    private Coffee _coffee;
    public MilkDecorator(Coffee coffee) { _coffee = coffee; }
    
    public override double Cost() => _coffee.Cost() + 2.0;
    public override string Description() => _coffee.Description() + ", Milk";
}`,
                        codeDesc: "`MilkDecorator` ç¹¼æ‰¿è‡ª `Coffee` ä¸¦æŒæœ‰ä¸€å€‹ `Coffee` ç‰©ä»¶ã€‚å®ƒåœ¨å‘¼å« `Cost()` æ™‚ï¼Œæœƒå…ˆå‘¼å«è¢«åŒ…è£ç‰©ä»¶çš„ `Cost()` åŠ ä¸Šè‡ªå·±çš„åƒ¹æ ¼ï¼Œé”æˆåŠŸèƒ½ç–ŠåŠ ã€‚",
                        pros: [
                            "æ¯”ç¹¼æ‰¿æ›´æœ‰å½ˆæ€§ï¼šå¯ä»¥åœ¨åŸ·è¡ŒæœŸå‹•æ…‹æ±ºå®šç‰©ä»¶çš„è¡Œç‚ºã€‚",
                            "é¿å…é¡åˆ¥çˆ†ç‚¸é »ç¹ï¼šä¸éœ€è¦ç‚ºæ¯ä¸€ç¨®çµ„åˆ (å¦‚ Milk+Sugar, MilkOnly) å»ºç«‹å­é¡åˆ¥ã€‚",
                            "å–®ä¸€è·è²¬åŸå‰‡ï¼šæ¯å€‹è£é£¾è€…åªå°ˆæ³¨æ·»åŠ ä¸€ç¨®åŠŸèƒ½ã€‚"
                        ]
                    },
                    {
                        id: "proxy",
                        name: "Proxy (ä»£ç†æ¨¡å¼)",
                        desc: "ç‚ºå…¶ä»–ç‰©ä»¶æä¾›ä¸€ç¨®ä»£ç†ä»¥æ§åˆ¶å°é€™å€‹ç‰©ä»¶çš„å­˜å–ã€‚",
                        scenarios: [
                            "æ¬Šé™æ§åˆ¶",
                            "å»¶é²è¼‰å…¥ (Lazy Loading)",
                            "é ç«¯ä»£ç† (Remote Proxy)"
                        ],
                        diagram: `classDiagram
    class Subject {
        <<interface>>
        +request()
    }
    class RealSubject {
        +request()
    }
    class Proxy {
        -realSubject
        +request()
    }
    Subject <|.. RealSubject
    Subject <|.. Proxy
    Proxy --> RealSubject`,
                        code: `public interface ISubject
{
    void Request();
}

public class RealSubject : ISubject
{
    public void Request() => Console.WriteLine("RealSubject: Handling request.");
}

public class Proxy : ISubject
{
    private RealSubject _realSubject;

    public void Request()
    {
        if (_realSubject == null)
        {
            Console.WriteLine("Proxy: Checking access and creating RealSubject.");
            _realSubject = new RealSubject();
        }
        _realSubject.Request();
    }
}`,
                        codeDesc: "`Proxy` å¯¦ä½œäº†èˆ‡ `RealSubject` ç›¸åŒçš„ä»‹é¢ã€‚åœ¨æ­¤ç¯„ä¾‹ä¸­ï¼ŒProxy å¯¦ä½œäº†ã€Œå»¶é²åˆå§‹åŒ– (Lazy Initialization)ã€ï¼Œåªæœ‰åœ¨çœŸæ­£å‘¼å« `Request()` æ™‚æ‰å»ºç«‹ `RealSubject`ã€‚",
                        pros: [
                            "å¯ä»¥åœ¨ä¸ä¿®æ”¹å®¢æˆ¶ç«¯çš„æƒ…æ³ä¸‹æ§åˆ¶æœå‹™ç‰©ä»¶ã€‚",
                            "å¯ä»¥ç®¡ç†æœå‹™ç‰©ä»¶çš„ç”Ÿå‘½é€±æœŸ (å‰µå»º/éŠ·æ¯€)ã€‚",
                            "å³ä½¿æœå‹™ç‰©ä»¶é‚„æ²’æº–å‚™å¥½ï¼Œä»£ç†ä¹Ÿå¯ä»¥æ­£å¸¸é‹ä½œ (å¦‚é¡¯ç¤º Loading)ã€‚"
                        ]
                    },
                    {
                        id: "facade",
                        name: "Facade (å¤–è§€æ¨¡å¼)",
                        desc: "ç‚ºå­ç³»çµ±ä¸­çš„ä¸€çµ„ä»‹é¢æä¾›ä¸€å€‹ä¸€è‡´çš„ä»‹é¢ï¼Œç°¡åŒ–ä½¿ç”¨ã€‚",
                        scenarios: [
                            "ç°¡åŒ–è¤‡é›œ library çš„ä½¿ç”¨æ–¹å¼",
                            "æä¾›é«˜å±¤æ¬¡çš„æ“ä½œä»‹é¢"
                        ],
                        diagram: `classDiagram
    class Facade {
        +operation()
    }
    class SubSystem1 {
        +op1()
    }
    class SubSystem2 {
        +op2()
    }
    Facade --> SubSystem1
    Facade --> SubSystem2`,
                        code: `public class SubSystem1
{
    public string Operation1() => "Sub1 Ready";
}

public class SubSystem2
{
    public string Operation2() => "Sub2 Go";
}

public class ComputerFacade
{
    private SubSystem1 _s1;
    private SubSystem2 _s2;

    public ComputerFacade()
    {
        _s1 = new SubSystem1();
        _s2 = new SubSystem2();
    }

    public string Start()
    {
        return $"{_s1.Operation1()} + {_s2.Operation2()}";
    }
}`,
                        codeDesc: "`ComputerFacade` å°è£äº† `SubSystem1` èˆ‡ `SubSystem2` çš„è¤‡é›œåˆå§‹åŒ–èˆ‡å‘¼å«éç¨‹ï¼Œæä¾›ä¸€å€‹ç°¡å–®çš„ `Start()` æ–¹æ³•ä¾›å¤–éƒ¨ä½¿ç”¨ã€‚",
                        pros: [
                            "è®“ç¨‹å¼ç¢¼èˆ‡è¤‡é›œçš„å­ç³»çµ±è§£è€¦ã€‚",
                            "æä¾›ç°¡å–®çš„ä»‹é¢ï¼Œé™ä½å­¸ç¿’èˆ‡ä½¿ç”¨é–€æª»ã€‚",
                            "å¯ä»¥æ›´å¥½åœ°åŠƒåˆ†å±¤æ¬¡çµæ§‹ã€‚"
                        ]
                    },
                    {
                        id: "composite",
                        name: "Composite (çµ„åˆæ¨¡å¼)",
                        desc: "å°‡ç‰©ä»¶çµ„åˆæˆæ¨¹å½¢çµæ§‹ä»¥è¡¨ç¤ºã€Œéƒ¨åˆ†-æ•´é«”ã€çš„å±¤æ¬¡çµæ§‹ã€‚",
                        scenarios: [
                            "æª”æ¡ˆç³»çµ± (File/Folder)",
                            "GUI æ¨¹ç‹€çµæ§‹ (Control/Panel)"
                        ],
                        diagram: `classDiagram
    class Component {
        +operation()
        +add(c)
        +remove(c)
    }
    class Leaf {
        +operation()
    }
    class Composite {
        -children
        +operation()
        +add(c)
        +remove(c)
    }
    Component <|-- Leaf
    Component <|-- Composite
    Composite o-- Component`,
                        code: `public abstract class Component
{
    public abstract void Display(int depth);
}

public class Leaf : Component
{
    private string _name;
    public Leaf(string name) { _name = name; }
    public override void Display(int depth) => Console.WriteLine(new String('-', depth) + _name);
}

public class Composite : Component
{
    private List<Component> _children = new List<Component>();
    private string _name;
    public Composite(string name) { _name = name; }
    
    public void Add(Component c) => _children.Add(c);
    
    public override void Display(int depth)
    {
        Console.WriteLine(new String('-', depth) + _name);
        foreach (var c in _children) c.Display(depth + 2);
    }
}`,
                        codeDesc: "`Composite` (å®¹å™¨) èˆ‡ `Leaf` (è‘‰ç¯€é») éƒ½ç¹¼æ‰¿è‡ª `Component`ã€‚é€™è®“ä½¿ç”¨è€…å¯ä»¥ä¸€è‡´åœ°å‘¼å« `Display()`ï¼Œç„¡è«–æ˜¯å°å–®ä¸€æª”æ¡ˆï¼Œæˆ–æ˜¯åŒ…å«å¤šå€‹æª”æ¡ˆçš„è³‡æ–™å¤¾ã€‚",
                        pros: [
                            "å¯ä»¥åˆ©ç”¨éè¿´çµæ§‹æ–¹ä¾¿åœ°è™•ç†è¤‡é›œçš„æ¨¹ç‹€è³‡æ–™ã€‚",
                            "ç¬¦åˆé–‹æ”¾å°é–‰åŸå‰‡ï¼šæ–°å¢æ–°çš„ç¯€é»é¡å‹ä¸éœ€ä¿®æ”¹ç¾æœ‰çµæ§‹ã€‚",
                            "ç°¡åŒ–äº†å®¢æˆ¶ç«¯ç¨‹å¼ç¢¼ï¼Œå› ç‚ºä¸éœ€å€åˆ†æ˜¯è™•ç†å–®ä¸€ç‰©ä»¶é‚„æ˜¯çµ„åˆç‰©ä»¶ã€‚"
                        ]
                    }
                ]
            },
            behavioral: {
                name: "è¡Œç‚ºå‹ (Behavioral)",
                description: "é—œæ³¨ç‰©ä»¶ä¹‹é–“çš„é€šè¨Šèˆ‡è·è²¬åˆ†é…ã€‚",
                items: [
                    {
                        id: "observer",
                        name: "Observer (è§€å¯Ÿè€…æ¨¡å¼)",
                        desc: "å®šç¾©ç‰©ä»¶é–“çš„ä¸€å°å¤šä¾è³´ï¼Œç•¶ç‰©ä»¶ç‹€æ…‹æ”¹è®Šï¼Œæ‰€æœ‰ä¾è³´è€…éƒ½æœƒæ”¶åˆ°é€šçŸ¥ã€‚",
                        scenarios: [
                            "C# Events / Delegates",
                            "Model-View-Controller (MVC)",
                            "Reactive Extensions (Rx)"
                        ],
                        diagram: `classDiagram
    class Subject {
        -observers
        +attach(Observer)
        +detach(Observer)
        +notify()
    }
    class Observer {
        <<interface>>
        +update()
    }
    class ConcreteObserver {
        +update()
    }
    Subject o-- Observer
    Observer <|.. ConcreteObserver`,
                        code: `public class Subject
{
    // C# built-in observer pattern via Action or EventHandler
    public event Action<string> OnNotify;

    public void DoSomething()
    {
        // ... Logic
        OnNotify?.Invoke("Event happened!");
    }
}

// Usage
var subject = new Subject();
subject.OnNotify += msg => Console.WriteLine($"Observer 1: {msg}");
subject.OnNotify += msg => Console.WriteLine($"Observer 2: {msg}");
subject.DoSomething();`,
                        codeDesc: "ä½¿ç”¨ C# çš„ `event` æ©Ÿåˆ¶æ˜¯æœ€ç¶“å…¸çš„ Observer å¯¦ä½œã€‚è¨‚é–±è€…åªéœ€å°‡æ–¹æ³• (`+=`) è¨»å†Šåˆ°äº‹ä»¶ä¸Šï¼Œç•¶ `Subject` è§¸ç™¼äº‹ä»¶æ™‚ï¼Œæ‰€æœ‰è¨‚é–±è€…éƒ½æœƒæ”¶åˆ°é€šçŸ¥ã€‚",
                        pros: [
                            "ç¬¦åˆé–‹æ”¾å°é–‰åŸå‰‡ï¼šå¯ä»¥åœ¨ä¸ä¿®æ”¹ Subject çš„æƒ…æ³ä¸‹æ–°å¢è¨‚é–±è€…ã€‚",
                            "å»ºç«‹ç‰©ä»¶ä¹‹é–“çš„é¬†æ•£è€¦åˆé—œä¿‚ã€‚",
                            "æ”¯æ´å»£æ’­é€šè¨Šã€‚"
                        ]
                    },
                    {
                        id: "strategy",
                        name: "Strategy (ç­–ç•¥æ¨¡å¼)",
                        desc: "å®šç¾©ä¸€ç³»åˆ—æ¼”ç®—æ³•ï¼Œå°‡å®ƒå€‘å°è£èµ·ä¾†ï¼Œä¸¦ä½¿å®ƒå€‘å¯ä»¥äº’ç›¸æ›¿æ›ã€‚",
                        scenarios: [
                            "Dependency Injection (æ³¨å…¥ä¸åŒå¯¦ä½œ)",
                            "æ’åºç­–ç•¥ (SortStrategy)",
                            "æŠ˜æ‰£è¨ˆç®— (DiscountStrategy)"
                        ],
                        diagram: `classDiagram
    class Context {
        -strategy
        +setStrategy(Strategy)
        +execute()
    }
    class Strategy {
        <<interface>>
        +algorithm()
    }
    class StrategyA {
        +algorithm()
    }
    class StrategyB {
        +algorithm()
    }
    Context o-- Strategy
    Strategy <|.. StrategyA
    Strategy <|.. StrategyB`,
                        code: `public interface IStrategy
{
    int Execute(int a, int b);
}

public class AddStrategy : IStrategy
{
    public int Execute(int a, int b) => a + b;
}

public class Context
{
    private IStrategy _strategy;
    public Context(IStrategy strategy) { _strategy = strategy; }
    public int ExecuteStrategy(int a, int b) => _strategy.Execute(a, b);
}

// Usage
var context = new Context(new AddStrategy());
var result = context.ExecuteStrategy(10, 5);`,
                        codeDesc: "å°‡å…·é«”çš„æ¼”ç®—æ³•å°è£åœ¨ `AddStrategy` ä¸­ï¼Œ`Context` åªä¾è³´ `IStrategy` ä»‹é¢ã€‚é€™ä½¿å¾—æˆ‘å€‘å¯ä»¥åœ¨åŸ·è¡ŒæœŸç”±å¤–éƒ¨æ³¨å…¥ä¸åŒçš„ç­–ç•¥ã€‚",
                        pros: [
                            "å¯ä»¥åœ¨åŸ·è¡ŒæœŸåˆ‡æ›ç‰©ä»¶å…§çš„æ¼”ç®—æ³•ã€‚",
                            "å°‡å¯¦ä½œç´°ç¯€å¾ä½¿ç”¨å®ƒçš„é¡åˆ¥ä¸­åˆ†é›¢å‡ºä¾†ã€‚",
                            "ä½¿ç”¨çµ„åˆå–ä»£ç¹¼æ‰¿ï¼Œæ›´æœ‰å½ˆæ€§ã€‚"
                        ]
                    },
                    {
                        id: "command",
                        name: "Command (å‘½ä»¤æ¨¡å¼)",
                        desc: "å°‡è«‹æ±‚å°è£æˆç‰©ä»¶ï¼Œè®“ä½ å¯ç”¨ä¸åŒçš„è«‹æ±‚å°å®¢æˆ¶é€²è¡Œåƒæ•¸åŒ–ï¼Œä¸¦æ”¯æ´å¾©åŸæ“ä½œã€‚",
                        scenarios: [
                            "WPF ICommand",
                            "äº¤æ˜“ç³»çµ±",
                            "å·¨é›†éŒ„è£½ (Macro)"
                        ],
                        diagram: `classDiagram
    class Invoker {
        -command
        +setCommand(c)
        +executeCommand()
    }
    class Command {
        <<interface>>
        +execute()
    }
    class ConcreteCommand {
        -receiver
        +execute()
    }
    class Receiver {
        +action()
    }
    Invoker o-- Command
    Command <|.. ConcreteCommand
    ConcreteCommand --> Receiver`,
                        code: `public interface ICommand
{
    void Execute();
}

public class Light
{
    public void On() => Console.WriteLine("Light is On");
}

public class LightOnCommand : ICommand
{
    private Light _light;
    public LightOnCommand(Light light) { _light = light; }
    public void Execute() => _light.On();
}

public class Invoker
{
    private ICommand _command;
    public void SetCommand(ICommand cmd) => _command = cmd;
    public void Run() => _command.Execute();
}`,
                        codeDesc: "`LightOnCommand` å°‡ã€Œé–‹ç‡ˆã€é€™å€‹å‹•ä½œå°è£æˆä¸€å€‹ç‰©ä»¶ã€‚`Invoker` (å¦‚é™æ§å™¨) ä¸éœ€è¦çŸ¥é“å…·é«”å¦‚ä½•é–‹ç‡ˆï¼Œåªéœ€è¦å‘¼å« `Execute()`ã€‚",
                        pros: [
                            "å–®ä¸€è·è²¬åŸå‰‡ï¼šè§£è€¦ç™¼èµ·æ“ä½œçš„ç‰©ä»¶èˆ‡åŸ·è¡Œæ“ä½œçš„ç‰©ä»¶ã€‚",
                            "å¯ä»¥å¯¦ä½œå¾©åŸ (Undo) èˆ‡é‡åš (Redo) åŠŸèƒ½ã€‚",
                            "å¯ä»¥å°‡å‘½ä»¤æ”¾å…¥ä½‡åˆ— (Queue) ä¸­å»¶å¾ŒåŸ·è¡Œã€‚"
                        ]
                    },
                    {
                        id: "state",
                        name: "State (ç‹€æ…‹æ¨¡å¼)",
                        desc: "å…è¨±ä¸€å€‹ç‰©ä»¶åœ¨å…¶å…§éƒ¨ç‹€æ…‹æ”¹è®Šæ™‚æ”¹è®Šå®ƒçš„è¡Œç‚ºã€‚",
                        scenarios: [
                            "å·¥ä½œæµå¼•æ“ (Workflow)",
                            "TCP é€£ç·š",
                            "åª’é«”æ’­æ”¾å™¨ (Play/Pause/Stop)"
                        ],
                        diagram: `classDiagram
    class Context {
        -state
        +request()
    }
    class State {
        <<interface>>
        +handle()
    }
    class ConcreteStateA {
        +handle()
    }
    class ConcreteStateB {
        +handle()
    }
    Context o-- State
    State <|.. ConcreteStateA
    State <|.. ConcreteStateB`,
                        code: `public abstract class State
{
    protected Context _context;
    public void SetContext(Context context) => _context = context;
    public abstract void Handle();
}

public class Context
{
    private State _state;
    public Context(State state) { TransitionTo(state); }
    public void TransitionTo(State state)
    {
        _state = state;
        _state.SetContext(this);
    }
    public void Request() => _state.Handle();
}

public class ConcreteStateA : State
{
    public override void Handle() 
    {
        Console.WriteLine("State A handles request.");
        _context.TransitionTo(new ConcreteStateB());
    }
}
public class ConcreteStateB : State
{
    public override void Handle() => Console.WriteLine("State B handles request.");
}`,
                        codeDesc: "`Context` å°‡è¡Œç‚ºå§”è¨—çµ¦ç•¶å‰çš„ `State` ç‰©ä»¶ã€‚ç•¶ `ConcreteStateA` å®Œæˆè™•ç†å¾Œï¼Œå®ƒä¸»å‹•å°‡ Context çš„ç‹€æ…‹åˆ‡æ›ç‚º `ConcreteStateB`ï¼Œæ”¹è®Šäº† Context å¾ŒçºŒçš„è¡Œç‚ºã€‚",
                        pros: [
                            "å°‡èˆ‡ç‰¹å®šç‹€æ…‹ç›¸é—œçš„ç¨‹å¼ç¢¼é›†ä¸­åœ¨ä¸€å€‹é¡åˆ¥ä¸­ (SRP)ã€‚",
                            "æ¶ˆé™¤å†—é•·çš„ if-else æˆ– switch-case ç‹€æ…‹åˆ¤æ–·é‚è¼¯ã€‚",
                            "ç‹€æ…‹è½‰æ›é‚è¼¯æ¸…æ™°æ˜ç¢ºã€‚"
                        ]
                    },
                    {
                        id: "template_method",
                        name: "Template Method (æ¨£æ¿æ–¹æ³•)",
                        desc: "åœ¨ä¸€å€‹æ–¹æ³•ä¸­å®šç¾©æ¼”ç®—æ³•çš„éª¨æ¶ï¼Œå°‡ä¸€äº›æ­¥é©Ÿå»¶é²åˆ°å­é¡åˆ¥ä¸­ã€‚",
                        scenarios: [
                            "ASP.NET Page Life Cycle",
                            "å–®å…ƒæ¸¬è©¦ Setup/Teardown",
                            "è³‡æ–™åŒ¯å…¥æµç¨‹"
                        ],
                        diagram: `classDiagram
    class AbstractClass {
        +templateMethod()
        #primitiveOp1()
        #primitiveOp2()
    }
    class ConcreteClass {
        #primitiveOp1()
        #primitiveOp2()
    }
    AbstractClass <|-- ConcreteClass`,
                        code: `public abstract class AbstractClass
{
    // Template Method
    public void TemplateMethod()
    {
        PrimitiveOperation1();
        PrimitiveOperation2();
    }

    protected abstract void PrimitiveOperation1();
    protected abstract void PrimitiveOperation2();
}

public class ConcreteClass : AbstractClass
{
    protected override void PrimitiveOperation1() => Console.WriteLine("Op1");
    protected override void PrimitiveOperation2() => Console.WriteLine("Op2");
}`,
                        codeDesc: "`TemplateMethod` å®šç¾©äº†åŸ·è¡Œçš„é †åº (Op1 -> Op2)ï¼Œä½†å…·é«”çš„ Op1 èˆ‡ Op2 å¯¦ä½œå‰‡ç•™çµ¦å­é¡åˆ¥ `ConcreteClass` æ±ºå®šã€‚",
                        pros: [
                            "é€™æ˜¯ä¸€ç¨®ä»£ç¢¼å¾©ç”¨æŠ€è¡“ï¼Œå°‡å…¬å…±é‚è¼¯æå‡åˆ°çˆ¶é¡åˆ¥ã€‚",
                            "å­é¡åˆ¥å¯ä»¥è¦†å¯«æ¼”ç®—æ³•çš„ç‰¹å®šæ­¥é©Ÿï¼Œè€Œä¸æ”¹è®Šæ¼”ç®—æ³•çš„çµæ§‹ã€‚",
                            "åå‘æ§åˆ¶ (IoC)ï¼šçˆ¶é¡åˆ¥å‘¼å«å­é¡åˆ¥çš„æ“ä½œã€‚"
                        ]
                    },
                    {
                        id: "iterator",
                        name: "Iterator (ç–Šä»£å™¨æ¨¡å¼)",
                        desc: "æä¾›ä¸€ç¨®æ–¹æ³•é †åºå­˜å–ä¸€å€‹èšåˆç‰©ä»¶ä¸­å„å€‹å…ƒç´ ï¼Œè€Œåˆä¸æš´éœ²è©²ç‰©ä»¶çš„å…§éƒ¨è¡¨ç¤ºã€‚",
                        scenarios: [
                            "foreach è¿´åœˆ (IEnumerable/IEnumerator)",
                            "LINQ",
                            "è³‡æ–™åº« Cursor"
                        ],
                        diagram: `classDiagram
    class Iterable {
        +createIterator()
    }
    class Iterator {
        +next()
        +hasNext()
    }
    Iterable ..> Iterator`,
                        code: `public class DaysOfTheWeek : IEnumerable
{
    private string[] days = { "Sun", "Mon", "Tue" };

    public IEnumerator GetEnumerator()
    {
        for (int i = 0; i < days.Length; i++)
        {
            yield return days[i];
        }
    }
}

// Usage
foreach (var day in new DaysOfTheWeek())
{
    Console.WriteLine(day);
}`,
                        codeDesc: "C# çš„ `yield return` èªæ³•ç³–æ¥µå¤§åœ°ç°¡åŒ–äº†ç–Šä»£å™¨çš„å¯¦ä½œã€‚å¯¦ä½œ `IEnumerable` ä»‹é¢å¾Œï¼Œè©²ç‰©ä»¶å³å¯è¢« `foreach` è¿´åœˆç›´æ¥éæ­·ã€‚",
                        pros: [
                            "å–®ä¸€è·è²¬åŸå‰‡ï¼šå°‡éæ­·æ¼”ç®—æ³•å¾é›†åˆé¡åˆ¥ä¸­åˆ†é›¢å‡ºä¾†ã€‚",
                            "å¯ä»¥å°åŒä¸€å€‹é›†åˆåŒæ™‚é€²è¡Œå¤šå€‹éæ­·ã€‚",
                            "æä¾›ä¸€è‡´çš„ä»‹é¢ä¾†éæ­·ä¸åŒçš„é›†åˆçµæ§‹ (List, Tree, Graph)ã€‚"
                        ]
                    }
                ]
            }
        };

        // --- APP LOGIC ---
        const app = {
            markmap: null,
            isMapOnly: false,

            init() {
                mermaid.initialize({
                    startOnLoad: false,
                    theme: 'base',
                    securityLevel: 'loose'
                });
                this.renderSidebar();
                this.renderMarkmap();

                // Default view
                const firstPattern = DESIGN_PATTERNS.creational.items[0];
                this.showDetail(firstPattern.id);
            },

            generateMarkdown() {
                let md = `# Design Patterns\n\n`;
                for (const [key, category] of Object.entries(DESIGN_PATTERNS)) {
                    md += `## ${category.name}\n`;
                    category.items.forEach(item => {
                        md += `- ${item.name}\n`;
                    });
                }
                return md;
            },

            renderMarkmap() {
                const markdown = this.generateMarkdown();
                // Ensure markmap global is available
                if (!window.markmap) {
                    console.error('Markmap library not loaded');
                    return;
                }
                const { Markmap, Transformer } = window.markmap;
                const transformer = new Transformer();
                const { root } = transformer.transform(markdown);

                if (this.markmap) {
                    this.markmap.setData(root);
                    this.markmap.fit();
                } else {
                    this.markmap = Markmap.create('#markmap', {
                        embedGlobalCSS: true,
                        scrollForPan: true,
                        zoom: true,
                        pan: { enable: true },
                        initialExpandLevel: 2,
                        maxWidth: 300
                    }, root);

                    // Delay to ensure SVG nodes are created before attaching listeners
                    setTimeout(() => {
                        this.attachNodeListeners();
                        this.markmap.fit();
                    }, 800);
                }
            },

            attachNodeListeners() {
                // Markmap renders nodes as <g> elements with class "markmap-node"
                // The text is inside various levels of tspans or foreignObjects usually.
                // We'll select common text containers.

                // Newer Markmap versions render hierarchy differently. 
                // We will try to find the text elements.
                // Usually direct clicking might be intercepted by Markmap's own zoom/collapse handlers.
                // We rely on the fact that we can attach to the `g` container typically.

                const svg = document.querySelector('#markmap');
                if (!svg) return;

                // Markmap usually stops propagation, so we might need to capture.
                // However, Markmap node clicking toggles fold usually.
                // We want to detect the click payload.

                // A robustness strategy: Listen on the SVG and find the target text.
                svg.addEventListener('click', (e) => {
                    // Check if target is a text or tspan inside a node
                    let target = e.target;
                    // Walk up to find if it was a node content
                    // Markmap text usually resides in <tspan> inside <text> inside <g>

                    // Helper: get text content if it looks like a pattern name
                    const text = target.textContent.trim();
                    if (text) {
                        this.handleNodeClick(text);
                    }
                });
            },

            handleNodeClick(text) {
                // console.log("Clicked:", text); 
                let foundItem = null;
                let foundCategory = null;

                for (const [catKey, category] of Object.entries(DESIGN_PATTERNS)) {
                    // Check strict or loose match
                    if (text === category.name || category.name.includes(text) && text.length > 5) {
                        return; // Clicked Category: do nothing or expand? Markmap handles expand.
                    }
                    // Match pattern name
                    // Pattern names are like "Singleton (å–®ä¾‹æ¨¡å¼)"
                    // Clicked text might be "Singleton (å–®ä¾‹æ¨¡å¼)"
                    const item = category.items.find(i => i.name === text || (text.length > 3 && i.name.includes(text)));

                    if (item) {
                        foundItem = item;
                        foundCategory = category;
                        break;
                    }
                }

                if (foundItem) {
                    this.showDetail(foundItem.id);
                    if (this.isMapOnly) this.toggleMapOnly();
                }
            },

            findPatternById(id) {
                for (const cat of Object.values(DESIGN_PATTERNS)) {
                    const found = cat.items.find(i => i.id === id);
                    if (found) return { item: found, category: cat };
                }
                return null;
            },

            renderSidebar() {
                const nav = document.getElementById('pattern-nav');
                let html = '';

                for (const [key, category] of Object.entries(DESIGN_PATTERNS)) {
                    html += `
                        <div class="mb-4">
                            <div class="px-6 py-2 text-xs font-bold text-slate-400 uppercase tracking-wider">${category.name}</div>
                            <div class="space-y-1">
                     `;
                    category.items.forEach(item => {
                        html += `
                            <button onclick="app.showDetail('${item.id}')" id="nav-${item.id}"
                                class="nav-item w-full text-left px-6 py-2 text-sm text-slate-600 hover:bg-white/50 hover:text-indigo-600 transition-colors border-l-4 border-transparent pl-5">
                                ${item.name.split(' ')[0]}
                            </button>
                         `;
                    });
                    html += `</div></div>`;
                }
                nav.innerHTML = html;
            },

            async showDetail(id) {
                const result = this.findPatternById(id);
                if (!result) return;
                const { item, category } = result;

                // UI Reset
                document.getElementById('empty-state').classList.add('hidden');
                document.getElementById('content-state').classList.remove('hidden');
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                const navBtn = document.getElementById(`nav-${id}`);
                if (navBtn) navBtn.classList.add('active');

                // Fill Content
                document.getElementById('pattern-type').textContent = category.name.split(' ')[0];
                document.getElementById('pattern-title').textContent = item.name;
                document.getElementById('pattern-desc').textContent = item.desc;

                document.getElementById('pattern-scenario').innerHTML = item.scenarios.map(s => `<li>${s}</li>`).join('');

                // Code Description & Pros
                document.getElementById('code-desc').textContent = item.codeDesc || "æš«ç„¡èªªæ˜";
                document.getElementById('code-pros').innerHTML = (item.pros || []).map(p => `<li>${p}</li>`).join('');

                // Highlight.js Fix
                const codeBlock = document.getElementById('pattern-code');
                delete codeBlock.dataset.highlighted;
                codeBlock.className = 'language-csharp';
                codeBlock.textContent = item.code;
                hljs.highlightElement(codeBlock);

                // Mermaid Render
                const mermaidContainer = document.getElementById('mermaid-diagram');
                mermaidContainer.textContent = item.diagram;
                mermaidContainer.removeAttribute('data-processed'); // Reset mermaid

                try {
                    await mermaid.run({
                        nodes: [mermaidContainer]
                    });
                } catch (e) {
                    console.error("Mermaid error:", e);
                    mermaidContainer.innerHTML = `<div class="text-red-500 text-sm p-4">Diagram Render Failed:<br>${e.message}</div>`;
                }
            },

            toggleMapOnly() {
                this.isMapOnly = !this.isMapOnly;
                const mapPanel = document.getElementById('map-panel');
                const detailPanel = document.getElementById('detail-panel');

                if (this.isMapOnly) {
                    mapPanel.classList.remove('w-1/2');
                    mapPanel.classList.add('w-full');
                    detailPanel.classList.add('hidden');
                } else {
                    mapPanel.classList.add('w-1/2');
                    mapPanel.classList.remove('w-full');
                    detailPanel.classList.remove('hidden');
                }
                if (this.markmap) setTimeout(() => this.markmap.fit(), 300);
            }
        };

        window.addEventListener('DOMContentLoaded', () => {
            app.init();
        });

    </script>
</body>

</html>